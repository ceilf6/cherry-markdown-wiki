> 注意，本篇wiki只适用 **0.8.42** 及以上版本

## 目录
- 事件列表
    - [urlProcessor 解析url](https://github.com/Tencent/cherry-markdown/wiki/%E4%BA%8B%E4%BB%B6%26%E5%9B%9E%E8%B0%83#urlprocessor-%E8%A7%A3%E6%9E%90url)
    - [fileUpload 上传文件](https://github.com/Tencent/cherry-markdown/wiki/%E4%BA%8B%E4%BB%B6%26%E5%9B%9E%E8%B0%83#urlprocessor-%E8%A7%A3%E6%9E%90url)
    - [beforeImageMounted 加载图片](https://github.com/Tencent/cherry-markdown/wiki/%E4%BA%8B%E4%BB%B6%26%E5%9B%9E%E8%B0%83#beforeimagemounted-%E5%8A%A0%E8%BD%BD%E5%9B%BE%E7%89%87)
    - onClickPreview 点击预览区域
    - onCopyCode 复制预览区代码块
    - changeString2Pinyin 转拼音

-----
## 事件列表
### urlProcessor 解析url
urlProcessor(url: string, srcType: 'image' | 'audio' | 'video' | 'autolink' | 'link')
>对图片、视频、音频、超链接字符串、超链接 里的url做处理

举个例子，使超链接字符串生成的<a>标签都要是`https`

代码如下：
``` javascript
cherry.on('urlProcessor', function(url, type){
    console.log(url, type);
    if (type === 'autolink') {
        return url.replace(/^http:/, 'https:');
    }
    return url;
});
```
效果如下：
![image](https://github.com/Tencent/cherry-markdown/assets/998441/2ac76b91-0437-4af0-8d4b-d5466160dd26)

-----
### fileUpload 上传文件
fileUpload(file: File, callback: function)
>上传文件的回调
>
>其中callback会接收以下参数：
> - url 上传文件后的url 或 base64内容
> - params.name 回填的alt信息
> - params.poster 封面图片地址（视频的场景下生效）
> - params.isBorder 是否有边框样式（图片场景下生效）
> - params.isShadow 是否有阴影样式（图片场景下生效）
> - params.isRadius 是否有圆角样式（图片场景下生效）
> - params.width 设置宽度，可以是像素、也可以是百分比（图片、视频场景下生效）
> - params.height 设置高度，可以是像素、也可以是百分比（图片、视频场景下生效）

举个例子，将上传的图片全部转成base64格式

代码如下：
``` javascript
cherry.on('fileUpload', function(file, callback){
    if (/image/i.test(file.type)) {
        // 如果上传的是图片，则默认回显base64内容（因为没有图床）
        // 创建 FileReader 对象
        const reader = new FileReader();
        // 读取文件内容
        reader.onload = (event) => {
        // 获取 base64 内容
        const base64Content = event.target.result;
        callback(base64Content, {
            name: `${file.name.replace(/\.[^.]+$/, '')}`,
            isShadow: true,
            isRadius: true,
            width: '30%',
            height: 'auto',
        });
        };
        reader.readAsDataURL(file);
    } else {
        callback('images/demo-dog.png');
    }
})
```
效果如下：
![image](https://github.com/Tencent/cherry-markdown/assets/998441/db253675-7283-47cf-8412-b052046379ef)

-----
### beforeImageMounted 加载图片
beforeImageMounted(srcProp: string, src: string)
>在预览区输出`<img>`标签之前触发

举个例子，将图片的src属性替换成data-temp-src属性

代码如下：
``` javascript
cherry.on('beforeImageMounted', function(srcProp, src) {
    return {srcProp: 'data-temp-src', src}
})
```
效果：
``` javascript
<img data-temp-src="xxxx">
```


-----
### onClickPreview 点击预览区域
onClickPreview(e: MouseEvent)
>鼠标点击预览区域时触发

-----
### onCopyCode 复制预览区代码块
onCopyCode(e: MouseEvent, code: string)
>鼠标点击预览区域代码块复制按钮时触发

举个例子，复制代码块时自动带上代码块语法

代码如下：
``` javascript
cherry.on('onCopyCode', function(event, code) {
    return '```\n' + code + '\n```';
})
```

-----
### changeString2Pinyin 转拼音
changeString2Pinyin(str: string)
> cherry的ruby语法会通过该方法将中文转成拼音

具体例子可以看[这里](https://github.com/Tencent/cherry-markdown/blob/main/examples/scripts/index-demo.js#L233C26-L233C32)

-----
### onPaste 粘贴内容
onPaste(clipboardData: ClipboardEvent['clipboardData'])
>在编辑区域粘贴内容时回调

随便举个例子，代码如下：
``` javascript
/**
 * 粘贴时触发
 * @param {ClipboardEvent['clipboardData']} clipboardData
 * @returns
 *    false: 走cherry粘贴的默认逻辑
 *    string: 直接粘贴的内容
*/
function onPaste(clipboardData) {
    return false;
}
cherry.on('onPaste', onPaste);
```

-----
### afterChange 编辑区内容变更
afterChange(text: string, html: string)
>编辑区内容有**实际变更**后触发，其中text为markdown内容

-----
### afterInit cherry完成初始化
afterInit(text: string, html: string)
>cherry完成初始化后触发，其中text为markdown内容

-----
### focus 编辑区focus
focus(e: MouseEvent)
>编辑区获得焦点时触发

-----
### blur 编辑区blur
blur(e: MouseEvent)
>编辑区失去焦点时触发

----

## 注册事件&回调
### 配置式
``` javascript
var config = {
    id: 'markdown',
    value: '',
    callback: {
        urlProcessor: callbacks.urlProcessor,
        fileUpload: callbacks.fileUpload,
        beforeImageMounted: callbacks.beforeImageMounted,
        onClickPreview: callbacks.onClickPreview,
        onCopyCode: callbacks.onCopyCode,
        changeString2Pinyin: callbacks.changeString2Pinyin,
        onPaste: callbacks.onPaste,
    },
    event: {
        afterChange: callbacks.afterChange,
        afterInit: callbacks.afterInit,
        focus: (event, cherryInstance) => {},
        blur: (event, cherryInstance) => {},
    },
};
var cherry = new Cherry(config);
```

### 动态绑定
``` javascript
function afterChange(){
    console.log('change');
}
...
...
var cherry = new Cherry(config);
...
...
cherry.on('afterChange', afterChange);
...
...
cherry.off('afterChange', afterChange);
```
